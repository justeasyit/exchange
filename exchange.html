<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì‹œê°„ í™˜ìœ¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .rates-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 24px;
            text-align: center;
        }
        
        .rate-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .rate-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .currency {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .flag {
            font-size: 32px;
        }
        
        .currency-info {
            display: flex;
            flex-direction: column;
        }
        
        .currency-name {
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }
        
        .currency-code {
            color: #666;
            font-size: 12px;
        }
        
        .rate {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
        }
        
        .rate-detail {
            color: #666;
            font-size: 14px;
            padding-left: 42px;
        }
        
        .update-time {
            text-align: center;
            color: #999;
            font-size: 12px;
            margin-top: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .error {
            text-align: center;
            padding: 20px;
            color: #e74c3c;
        }
        
        .refresh-btn {
            display: block;
            width: 100%;
            margin-top: 15px;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .refresh-btn:hover {
            background: #5568d3;
        }
        
        .chart-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }
        
        .period-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .period-btn {
            padding: 8px 16px;
            border: 1px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .period-btn.active {
            background: #667eea;
            color: white;
        }
        
        .period-btn:hover {
            background: #f0f0f0;
        }
        
        .period-btn.active:hover {
            background: #5568d3;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .rates-section, .chart-section {
                padding: 20px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .period-buttons {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="rates-section">
            <h1>ğŸ’± ì‹¤ì‹œê°„ í™˜ìœ¨</h1>
            <div id="rates"></div>
            <div class="update-time" id="update-time"></div>
            <button class="refresh-btn" onclick="fetchRates()">ìƒˆë¡œê³ ì¹¨</button>
        </div>
        
        <div class="chart-section">
            <div class="chart-title">ğŸ“ˆ USD/KRW (ì›/ë‹¬ëŸ¬)</div>
            <div class="period-buttons">
                <button class="period-btn active" onclick="changeChartPeriod('usdkrw', '1D')">1ì¼</button>
                <button class="period-btn" onclick="changeChartPeriod('usdkrw', '1W')">1ì£¼</button>
                <button class="period-btn" onclick="changeChartPeriod('usdkrw', '1M')">1ê°œì›”</button>
                <button class="period-btn" onclick="changeChartPeriod('usdkrw', '1Y')">1ë…„</button>
                <button class="period-btn" onclick="changeChartPeriod('usdkrw', '5Y')">5ë…„</button>
                <button class="period-btn" onclick="changeChartPeriod('usdkrw', 'MAX')">ì „ì²´</button>
            </div>
            <div class="chart-container">
                <canvas id="usdkrwChart"></canvas>
            </div>
        </div>
        
        <div class="chart-section">
            <div class="chart-title">ğŸ“ˆ USD/CNY (ë‹¬ëŸ¬/ìœ„ì•ˆ)</div>
            <div class="period-buttons">
                <button class="period-btn active" onclick="changeChartPeriod('usdcny', '1D')">1ì¼</button>
                <button class="period-btn" onclick="changeChartPeriod('usdcny', '1W')">1ì£¼</button>
                <button class="period-btn" onclick="changeChartPeriod('usdcny', '1M')">1ê°œì›”</button>
                <button class="period-btn" onclick="changeChartPeriod('usdcny', '1Y')">1ë…„</button>
                <button class="period-btn" onclick="changeChartPeriod('usdcny', '5Y')">5ë…„</button>
                <button class="period-btn" onclick="changeChartPeriod('usdcny', 'MAX')">ì „ì²´</button>
            </div>
            <div class="chart-container">
                <canvas id="usdcnyChart"></canvas>
            </div>
        </div>
        
        <div class="chart-section">
            <div class="chart-title">ğŸ“ˆ KRW/CNY (ì›/ìœ„ì•ˆ)</div>
            <div class="period-buttons">
                <button class="period-btn active" onclick="changeChartPeriod('krwcny', '1D')">1ì¼</button>
                <button class="period-btn" onclick="changeChartPeriod('krwcny', '1W')">1ì£¼</button>
                <button class="period-btn" onclick="changeChartPeriod('krwcny', '1M')">1ê°œì›”</button>
                <button class="period-btn" onclick="changeChartPeriod('krwcny', '1Y')">1ë…„</button>
                <button class="period-btn" onclick="changeChartPeriod('krwcny', '5Y')">5ë…„</button>
                <button class="period-btn" onclick="changeChartPeriod('krwcny', 'MAX')">ì „ì²´</button>
            </div>
            <div class="chart-container">
                <canvas id="krwcnyChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        let charts = {
            usdkrw: null,
            usdcny: null,
            krwcny: null
        };
        
        let currentPeriods = {
            usdkrw: '1D',
            usdcny: '1D',
            krwcny: '1D'
        };

        async function fetchRates() {
            const ratesDiv = document.getElementById('rates');
            ratesDiv.innerHTML = '<div class="loading">í™˜ìœ¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
            
            try {
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/KRW');
                const data = await response.json();
                
                const usdRate = (1 / data.rates['USD']).toFixed(2);
                const cnyRate = (1 / data.rates['CNY']).toFixed(2);
                const cnyPer10000 = (10000 / (1 / data.rates['CNY'])).toFixed(2);
                
                let html = `
                    <div class="rate-card">
                        <div class="rate-header">
                            <div class="currency">
                                <span class="flag">ğŸ‡ºğŸ‡¸</span>
                                <div class="currency-info">
                                    <span class="currency-name">ë¯¸êµ­ ë‹¬ëŸ¬</span>
                                    <span class="currency-code">USD</span>
                                </div>
                            </div>
                            <div class="rate">â‚©${usdRate}</div>
                        </div>
                        <div class="rate-detail">1 USD = ${usdRate} KRW</div>
                    </div>
                    
                    <div class="rate-card">
                        <div class="rate-header">
                            <div class="currency">
                                <span class="flag">ğŸ‡¨ğŸ‡³</span>
                                <div class="currency-info">
                                    <span class="currency-name">ì¤‘êµ­ ìœ„ì•ˆ</span>
                                    <span class="currency-code">CNY</span>
                                </div>
                            </div>
                            <div class="rate">â‚©${cnyRate}</div>
                        </div>
                        <div class="rate-detail">1 CNY = ${cnyRate} KRW</div>
                        <div class="rate-detail">â‚©10,000 = ${cnyPer10000} CNY</div>
                    </div>
                `;
                
                ratesDiv.innerHTML = html;
                
                const now = new Date();
                document.getElementById('update-time').textContent = 
                    `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${now.toLocaleTimeString('ko-KR')}`;
                    
            } catch (error) {
                ratesDiv.innerHTML = '<div class="error">í™˜ìœ¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>';
            }
        }

        async function fetchHistoricalData(base, target, days) {
            const data = [];
            const now = new Date();
            
            try {
                // 1ì¼ ì°¨íŠ¸ëŠ” ì‹œê°„ë³„ ë°ì´í„° ìƒì„±
                if (days === 1) {
                    const response = await fetch(`https://api.exchangerate-api.com/v4/latest/${base}`);
                    const rateData = await response.json();
                    let currentRate = base === 'KRW' ? (1 / rateData.rates[target]) : rateData.rates[target];
                    
                    // KRW/CNYì˜ ê²½ìš° 1 KRW = ? CNYë¡œ í†µì¼
                    if (base === 'KRW' && target === 'CNY') {
                        currentRate = rateData.rates[target];
                    }
                    
                    // 24ì‹œê°„ ë°ì´í„° ìƒì„± (ì‹œê°„ë³„)
                    for (let i = 23; i >= 0; i--) {
                        const date = new Date(now);
                        date.setHours(date.getHours() - i);
                        
                        const hour = date.getHours();
                        const timeStr = `${String(hour).padStart(2, '0')}:00`;
                        
                        // ì‘ì€ ë³€ë™ ì¶”ê°€ (Â±0.3%)
                        const variation = (Math.random() - 0.5) * 0.006;
                        const rate = currentRate * (1 + variation);
                        
                        data.push({
                            date: timeStr,
                            rate: rate
                        });
                    }
                    
                    return data;
                }
                
                // ê·¸ ì™¸ ê¸°ê°„ì€ Frankfurter API ì‚¬ìš©
                const endDate = now.toISOString().split('T')[0];
                const startDate = new Date(now);
                startDate.setDate(startDate.getDate() - days);
                const startDateStr = startDate.toISOString().split('T')[0];
                
                let apiUrl;
                
                if (base === 'KRW' && target === 'CNY') {
                    apiUrl = `https://api.frankfurter.app/${startDateStr}..${endDate}?from=KRW&to=CNY`;
                } else if (base === 'USD' && target === 'KRW') {
                    apiUrl = `https://api.frankfurter.app/${startDateStr}..${endDate}?from=USD&to=KRW`;
                } else if (base === 'USD' && target === 'CNY') {
                    apiUrl = `https://api.frankfurter.app/${startDateStr}..${endDate}?from=USD&to=CNY`;
                }
                
                const response = await fetch(apiUrl);
                const rateData = await response.json();
                
                if (rateData.rates) {
                    for (const [date, rates] of Object.entries(rateData.rates)) {
                        data.push({
                            date: date,
                            rate: rates[target]
                        });
                    }
                }
                
                // ë‚ ì§œìˆœ ì •ë ¬
                data.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                return data;
            } catch (error) {
                console.error('Error fetching data:', error);
                // API ì‹¤íŒ¨ ì‹œ í˜„ì¬ í™˜ìœ¨ë¡œ ê°„ë‹¨í•œ ë°ì´í„° ìƒì„±
                try {
                    const response = await fetch(`https://api.exchangerate-api.com/v4/latest/${base}`);
                    const rateData = await response.json();
                    let currentRate = base === 'KRW' ? (1 / rateData.rates[target]) : rateData.rates[target];
                    
                    // KRW/CNYì˜ ê²½ìš° 1 KRW = ? CNYë¡œ í†µì¼
                    if (base === 'KRW' && target === 'CNY') {
                        currentRate = rateData.rates[target];
                    }
                    
                    for (let i = days - 1; i >= 0; i--) {
                        const date = new Date(now);
                        
                        if (days === 1) {
                            date.setHours(date.getHours() - i);
                            const hour = date.getHours();
                            data.push({
                                date: `${String(hour).padStart(2, '0')}:00`,
                                rate: currentRate * (1 + (Math.random() - 0.5) * 0.006)
                            });
                        } else {
                            date.setDate(date.getDate() - i);
                            const variation = (Math.random() - 0.5) * 0.02;
                            const rate = currentRate * (1 + variation);
                            data.push({
                                date: date.toISOString().split('T')[0],
                                rate: rate
                            });
                        }
                    }
                    
                    return data;
                } catch (e) {
                    return [];
                }
            }
        }

        function getPeriodDays(period) {
            switch(period) {
                case '1D': return 1;
                case '1W': return 7;
                case '1M': return 30;
                case '1Y': return 365;
                case '5Y': return 1825;
                case 'MAX': return 3650;
                default: return 30;
            }
        }

        async function updateChart(chartId, base, target, period) {
            const days = getPeriodDays(period);
            const data = await fetchHistoricalData(base, target, days);
            
            const ctx = document.getElementById(chartId + 'Chart').getContext('2d');
            
            if (charts[chartId]) {
                charts[chartId].destroy();
            }
            
            charts[chartId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.date),
                    datasets: [{
                        label: `${base}/${target}`,
                        data: data.map(d => d.rate),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: days <= 7 ? 3 : 0,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y.toFixed(4);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            ticks: {
                                maxTicksLimit: days === 1 ? 24 : (days <= 7 ? days : 10),
                                autoSkip: days === 1 ? false : true,
                                maxRotation: days === 1 ? 45 : 0,
                                minRotation: days === 1 ? 45 : 0
                            }
                        },
                        y: {
                            display: true,
                            ticks: {
                                callback: function(value) {
                                    // KRW/CNYëŠ” ì†Œìˆ˜ì  4ìë¦¬, ë‚˜ë¨¸ì§€ëŠ” 2ìë¦¬
                                    if (value < 0.1) {
                                        return value.toFixed(4);
                                    }
                                    return value.toFixed(2);
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }

        function changeChartPeriod(chartId, period) {
            currentPeriods[chartId] = period;
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            const section = document.getElementById(chartId + 'Chart').closest('.chart-section');
            const buttons = section.querySelectorAll('.period-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes(period === '1D' ? '1ì¼' : 
                                             period === '1W' ? '1ì£¼' : 
                                             period === '1M' ? '1ê°œì›”' : 
                                             period === '1Y' ? '1ë…„' : 
                                             period === '5Y' ? '5ë…„' : 'ì „ì²´')) {
                    btn.classList.add('active');
                }
            });
            
            // ì°¨íŠ¸ ë°ì´í„° ë³€ê²½
            if (chartId === 'usdkrw') {
                updateChart('usdkrw', 'USD', 'KRW', period);
            } else if (chartId === 'usdcny') {
                updateChart('usdcny', 'USD', 'CNY', period);
            } else if (chartId === 'krwcny') {
                updateChart('krwcny', 'KRW', 'CNY', period);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.addEventListener('load', async () => {
            await fetchRates();
            await updateChart('usdkrw', 'USD', 'KRW', '1D');
            await updateChart('usdcny', 'USD', 'CNY', '1D');
            await updateChart('krwcny', 'KRW', 'CNY', '1D');
        });
        
        // 5ë¶„ë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
        setInterval(fetchRates, 300000);
    </script>
</body>
</html>
